CREATE VIEW {STG_VDATABASE}.VIEW_MERGE_{TABLE_NAME}
AS
SEL * FROM 
(
	SEL 
	{STG_TABLE_COLUMNS}
	'0' AS REJECTED_FLAG,
	CAST(NULL AS VARCHAR(100)) AS REJECTION_RULE
	FROM 
	{STG_DATABASE}.{TABLE_NAME} STG_TBL
	--WHERE STG_TBL.MODIFICATION_TYPE <> 'D'

	UNION ALL

	SEL 
	{WRK_TABLE_COLUMNS}
	'1' AS REJECTED_FLAG,
	RR_TBL."RULE_DESC" AS REJECTION_RULE
	FROM 
	{WRK_DATABASE}.{TABLE_NAME} WRK_TBL
	LEFT JOIN {source_DB}.{REJ_TABLE_NAME} RJ_TBL
	ON WRK_TBL.REF_KEY = RJ_TBL.REF_KEY
	LEFT JOIN {source_DB}.{REJ_TABLE_RULE} RR_TBL
	ON RJ_TBL.RULE_ID = RR_TBL.RULE_ID
	--WHERE WRK_TBL.MODIFICATION_TYPE <> 'D'
)X
QUALIFY ROW_NUMBER() OVER (PARTITION BY {TBL_PKs} ORDER BY X.BATCH_ID DESC,X.REF_KEY DESC) = 1;